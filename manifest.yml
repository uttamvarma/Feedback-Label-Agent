app:
  id: ari:cloud:ecosystem::app/d09ed9df-fde2-432a-aa75-945beca1609b
  runtime:
    name: nodejs22.x

modules:
  rovo:agent:
    - key: pm-feedback-agent
      name: PM Feedback Agent
      description: Applies Theme and Impact labels to customer feedback table
      prompt: |
        This agent classifies customer feedback rows by applying predefined "Theme" and "Impact" labels.
      conversationStarters:
        - Label feedback on this page
      actions:
        - label-feedback

  action:
    - key: label-feedback
      name: Label Feedback
      function: feedback-fn
      actionVerb: UPDATE
      contexts: [ 'confluence:page' ]
      description: >
        Parses the current page's first table, calls Atlassian AI to classify
        each feedback row with Theme and Impact, and updates the page in place.
      inputs:
        pageId:
          title: Page to Label
          type: string
          required: true
          description: Select the Confluence page containing the feedback table.

  function:
    - key: feedback-fn
      handler: index.main

permissions:
  scopes:
    - read:confluence-content.all
    - read:page:confluence
    - write:confluence-content
    - write:page:confluence
    - write:comment:confluence
    - read:confluence-space.summary
    - read:confluence-props
    - write:confluence-props
  external:
    fetch:
      backend:
        - address: api.atlassian.com